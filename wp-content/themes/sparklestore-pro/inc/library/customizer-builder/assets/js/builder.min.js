!function(e,t){var i=e(document),a=SparkleWP_Customizer_Builder.is_rtl,o=function(o,r){var n={id:r,controlId:"",cols:12,cellHeight:45,items:[],container:null,ready:!1,devices:{desktop:SparkleWP_Customizer_Builder.desktop_label,mobile:SparkleWP_Customizer_Builder.mobile_tablet_label},activePanel:"desktop",panels:{},activeRow:"main",draggingItem:null,getTemplate:_.memoize(function(){var t=this,i={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(a,o,s){return _.isUndefined(o)&&(o="tmpl-customize-control-"+t.type),!_.isUndefined(s)&&_.isString(s)?i.variable=s:i.variable="data",_.template(e("#"+o).html(),null,i)(a)}}),drag_drop:function(){var t=this;e(".sparklewp-device-panel",t.container).each(function(){var i=e(this),a=i.data("device"),o=[];t.panels[a]={},e(".sparklewp-cb-items",i).each(function(t){var i,s=e(this).attr("data-id")||"";i=s?"_sid_"+a+"-"+s:"_sid_"+a+t,e(this).attr("id",i),o[t]="#"+i}),e(".grid-stack",i).each(function(){var i=e(this).attr("data-id")||"";t.panels[a][i]=e(this),e(this).droppable({out:function(e,t){},over:function(e,t){},drop:function(i,a){var o=e(this);t.gridster(o,a,i),t.save()}})});var s=e("#_sid_all-sidebar",i),r=s.attr("id")||!1;e(".sparklewp-available-items .grid-stack-item",i).draggable({revert:"invalid",connectToSortable:!!r&&"#"+r,start:function(t,a){e("body").addClass("builder-item-moving"),e(".sparklewp-cb-items",i).css("z-index",""),a.helper.parent().css("z-index",9999),a.helper.closest(".sparklewp-available-items").addClass("spwp-available-item-moving")},stop:function(t,a){e("body").removeClass("builder-item-moving"),e(".sparklewp-cb-items",i).css("z-index",""),e(".sparklewp-available-items",i).removeClass("spwp-available-item-moving"),a.helper.parent().css("z-index","")}}),s.length>0&&(s.sortable({revert:!0,change:function(e,i){t.save()},receive:function(i,a){e(this).find(".grid-stack-item").removeAttr("style").attr("data-gs-width",1),t.save()}}),t.panels[a].sidebar=s),e(".sparklewp-available-items .grid-stack-item",i).resizable({handles:"w, e",stop:function(e,i){t.setGridWidth(i.element.parent(),i),t.save()}})})},sortGrid:function(t){e(".grid-stack-item",t).each(function(){var t=e(this),i=t.attr("data-gs-x")||0;i=parseInt(i);var a=t.next();if(a.length>0){var o=a.attr("data-gs-x")||0;i>(o=parseInt(o))&&t.insertAfter(a)}})},getX:function(e){var t=e.attr("data-gs-x")||0;return parseInt(t)},getW:function(e,t){var i;return _.isUndefined(t)&&(t=!1),i=t?e.attr("data-df-width")||1:e.attr("data-gs-width")||1,parseInt(i)},gridGetItemInfo:function(e,t,i){var a,o=this.getX(e),s=this.getW(e),r=0,n=0,l=!1;for(a=o-1;a>=0&&!l;)0===t[a]?r++:l=!0,a--;for(l=!1,a=o+s;a<this.cols&&!l;)0===t[a]?n++:l=!0,a++;return{flag:t,x:o,w:s,item:e,before:r,after:n,id:e.attr("data-id")||"",wrapper:i}},updateItemsPositions:function(e){for(var t=this.cols,i=0;i<=t;i++)"object"!=typeof e[i]&&"function"!=typeof e[i]||e[i].attr("data-gs-x",i)},gridster:function(e,t,i){var o,s=[],r=this,n=this.cols,l=function(e){for(var t=e.x,i=e.w,a=e.el,o=t;o<t+i;o++)s[o]=o===t?a:1},c=function(e){for(var t=e.x,i=e.w,a=(e.el,t);a<t+i;a++)s[a]=0},d=function(e,t){for(var i=0,a=e;a<n;a++)if(0===s[a])i++;else if(t)return i;return i},p=function(e,t){var i=0;void 0===t&&(t=!1);for(var a=e;a>=0;a--)if(0===s[a])i++;else if(t)return i;return i},f=function(e){return 0===s[e]},g=function(e,t){for(var i=e;i<e+t;){if(0!==s[i])return!1;i++}return!0},v=function(e){if(e<0)return{x:-1,w:1};var t,i,a,o=-1;if(s[e]<=1)for(t=e,a=!1;t>=0&&!a;)1!==s[t]&&0!==s[t]&&(o=t,a=!0),t--;else o=e;for(t=o+1,i=o;1===s[t];)i++,t++;return{x:o,w:i+1-o}},w=function(e){var t,i,a,o=-1;if(s[e]<n)for(t=e,a=!1;t<n&&!a;)1!==s[t]&&0!==s[t]&&(o=t,a=!0),t++;else o=e;for(t=o+1,i=o;1===s[t];)i++,t++;return{x:o,w:i+1-o}},u=function(e,t){var i=s.slice(),a=p(e);if(0===a)return t;var o=v(e),r=o.x>=0?o.x+o.w-1:e,n=t;n=t>a?a:t;for(var l=0,c=0,d=r;c<=n&&d>=0;)0===s[d]&&(c++,l=d),d--;var f=[],g=0;for(d=l;d<=r;d++)s[d]=0,0!==i[d]&&(f[g]=i[d],g++);for(g=0,d=l;d<=r;d++)void 0!==f[g]?s[d]=f[g]:s[d]=0,g++;return t-n},h=function(e,t){var i=s.slice(),a=d(e);if(0===a)return t;var o=v(e),r=o.x>=0?o.x:e,l=t;l=t<=a?t:a;for(var c=e,p=0,f=r;p<l&&f<n;)0===s[f]&&(p++,c=f),f++;var g=[],w=0;for(f=r;f<=c;f++)s[f]=0,0!==i[f]&&(g[w]=i[f],w++);for(w=g.length-1,f=c;f>=r;f--)void 0!==g[w]?s[f]=g[w]:s[f]=0,w--;return t-l},m=function(){r.updateItemsPositions(s)},b=function(e,t){var i,a,o,c,b=e.x,x=e.w,k=function(){for(var e=0,t=0;t<n;t++)0===s[t]&&e++;return e}();if(k<=0)return!1;if(_.isUndefined(t)&&(t=!1),!t){if(f(b)){if(g(b,c=x))return l(e),e.el.attr("data-gs-x",b),e.el.attr("data-gs-width",c),!0;for((i=(a=d(b,!0))+(o=p(b-1,!0))>=x&&x-a<=o?b-(x-a):b-o)<0&&(i=0),console.log("_re",a),console.log("_le",o),console.log("__x",i);c>=1;){if(g(i,c))return console.log({x:i,w:c}),e.x=i,e.w=c,l(e),e.el.attr("data-gs-x",i),e.el.attr("data-gs-width",c),!0;c--}}if(1===s[b]){var y=v(b);if(y.x>=0&&b>y.x+Math.floor(y.w/2)&&b>y.x&&(i=y.x+y.w,a=d(i,!0),console.log("__re",a),console.log("__re_X",i),a>=x))return l({el:e.el,x:i,w:x}),e.el.attr("data-gs-x",i),e.el.attr("data-gs-width",x),!0}}console.log("--------------------------------------------------------");!function(e,t){var i,a,o,n,l=0,c=!1;if(console.log("insert at x",t),console.log("insert node",e),f(t)){if(console.log("empty_at_X",t),i=v(t),a=w(t),i.x>-1){if(console.log("found_item_left",i),(l=d(i.x))>=e.w)if(g(t,e.w))console.log("found",e),b=t,c=!0;else if(e.ox>t)for(o=i.x+i.w,n=(n=p(o))<=e.w?e.w-n:e.w,h(o+1,n),l=d(o),console.log("loop_start_i",o),c=!1;o>i.x+i.w&&!c;)g(o,e.w)&&(console.log("found_in_loop__i",o),b=o,c=!0),o--;if(!c&&e.ox<t){console.log("try_move_items_to_left",i),o=i.x+i.w-1,n=p(i.x),console.log("el",n),n>e.w&&(n=e.w),n-=2,u(i.x,n),console.log("try_move_items_to_left_flag",s),console.log("el2",n),o-=l=d(o),a=w(t);var m=i.x+i.w;for(a.x>-1&&(m=a.x),console.log("loop_start 2_i",o);o<m&&!c;)g(o,e.w)&&(console.log("found_in_loop__@__i",o),b=o,c=!0),o++}c||(b=i.x+i.w,e.w=l,e.x=b,console.log("resize_new_w",l),console.log("resize_new_x",b))}else if(a.x>-1){console.log("found_item_right",a),a=w(t),l=d(t,!1),console.log("move_all_item_to Right");var _=l>=e.w?e.w:l;for(h(t,_),o=a.x,console.log("loop_start Right",o);o>=0&&!c;)g(o,e.w)&&(b=o,e.x=b,c=!0,console.log("found_in_while_r",o)),o--;c||(b=t,e.w=l,e.x=b,console.log("resize_r_new_w",l),console.log("resize_r_new_x",b))}}else if(console.log("x is not empty"),i=v(t),e.ox<i.x)if(u(t,e.w),console.log("Move All items to left"),f(t))b=t;else{for(;!f(t)&&t<=r.cols-1;)t++;b=t}else if(h(t,e.w),console.log("Move All items to right"),f(t))b=t;else{for(;!f(t)&&t>=0;)t--;b=t}b>r.cols&&(b=r.cols-1),e.x=b,console.log("new node x",b)}(e,_.clone(b));var C,I=b,z=!1,P=0;for(b+x>r.cols-1&&(P=p(b,!0),console.log("le",P),P>0&&console.log("move_Left",b+x-r.cols-1)),m(),P=0;x>=1;){if(k>=x){if(g(b,x))return console.log("",{x:b,w:x}),e.w=x,l(e),e.el.attr("data-gs-x",b),e.el.attr("data-gs-width",x),!0;for(z=!1,P=p(b,!0),I=b-P,console.log("newX",I),C=I;C<n&&!z;){if(g(C,x))return console.log("Insert in While",{x:C,w:x}),e.w=x,l({el:e.el,x:C,w:x}),e.el.attr("data-gs-x",C),e.el.attr("data-gs-width",x),z=!0,!0;C++}}x--}for(x=e.w,z=!1;x>=1;){for(C=0;C<n&&!z;){if(g(C,x))return console.log("Insert in While 2",{x:C,w:x}),l({el:e.el,x:C,w:x}),e.el.attr("data-gs-x",C),e.el.attr("data-gs-width",x),z=!0,!0;C++}x--}return console.log("Insert END While",{x:C,w:x}),!1};o=(s=(r=this).getFlag(e)).slice();var x=e.offset();r.draggingItem=t.draggable;var k,y,C,I,z=e.width(),P=z/r.cols,D=0,S=t.offset;y=r.getW(t.draggable,!1),k=r.getW(t.draggable,!0),C=t.draggable.width(),console.log("DROP ITEM WIDTH",k),console.log("DROP ITEM cw WIDTH",y);var A=r.getX(t.draggable);a&&c({el:t.draggable,x:A,w:k});var W,T=0,G=0,M=!1;if(t.draggable.parent().is(e)?(I=!0,console.log("Item in this row"),k=y):(I=!1,console.log("Not in this row"),k<y&&(k=y)),a?(T=Math.round((x.left+z+10-i.clientX)/P),(G=Math.round((x.left+z-(S.left+C+10))/P))<0&&(G=0)):(T=Math.round((i.clientX-x.left)/P),(G=Math.round((S.left-x.left-10)/P))<0&&(G=0)),T>r.cols&&(T=r.cols),D=G,W=G,a)if(f(W))D=G,M=!0;else for(;W<r.cols&&!M;)f(W)?M=!0:W++;else if(f(D))D=G,M=!0;else{for(;D<=T&&!M;)f(D)?M=!0:D++;D>T&&(D=T)}if(M||(D=I?G:T),D<0&&(D=0),D+k>=r.cols){for(M=!0,W=D;W+k>r.cols&&M;)f(W)?W--:(W++,M=!1),console.log("loop_i",W);console.log("Find new _i, w: "+k,W),D=W}delete M,console.log("DROP Cursor",T),console.log("DROP row x cacl",D),console.log("DROP item w",k);var R={el:t.draggable,x:D,w:k,ox:A,ow:y};R.x<=0&&(R.x=0);var F=!1;I?(R.x=parseInt(t.draggable.attr("data-gs-x")||0),R.w=parseInt(t.draggable.attr("data-gs-width")||1),console.log("swap node",R),function(e,t){e.x;var i=e.w;c(e),console.log("Swap newX",t),console.log("Before Swap FLAG",s);var a=v(t),o=0;if(a.x>-1&&(o=a.x+a.w),g(t,i))return l({el:e.el,x:t,w:i}),!0;if(o>0&&g(o,i)&&t>=o){var n=w(t);if(n.x>-1&&e.w+t>=n.x)for(var d=_.clone(t);d>o;){if(g(d,i))return l({el:e.el,x:d,w:i}),!0;d--}if(t+i>r.cols){var p=r.cols-i;if(g(p,i))return l({el:e.el,x:p,w:i}),!0}return l({el:e.el,x:o,w:i}),!0}e.x=t,b(e,!0)}(R,D),F=!0):(F=b(R),console.log("Insert node")),F?(t.draggable.removeClass("item-from-list"),e.append(t.draggable),t.draggable.removeAttr("style"),console.log("DID Flag: ",s),r.draggingItem=null):(t.draggable.removeAttr("style"),console.log("Can not insert"),s=o),m(),r.updateAllGrids()},updateAllGrids:function(){var e=this;_.each(e.panels[e.activePanel],function(t,i){e.updateGridFlag(t)})},setGridWidth:function(e,t){var i,o,s=t.element,r=e.width(),n=t.size.width,l=t.originalSize.width,c=Math.ceil(r/this.cols)-1;a?(i=t.originalPosition.left>t.position.left,o=l!==n):(i=t.originalPosition.left>t.position.left,o=t.originalPosition.left<t.position.left);var d,p,f,g=t.originalElement.attr("data-gs-width")||1,v=t.originalElement.attr("data-gs-x")||0;g=parseInt(g),v=parseInt(v);var w,u=this.getFlag(e),h=this.gridGetItemInfo(t.originalElement,u,e);if(i)return a?(p=Math.floor((t.position.left-1)/c),(d=(p=this.cols-p)-v-g)>h.after&&(d=h.after),f=g+d,s.attr("data-gs-x",v).removeAttr("style"),s.attr("data-gs-width",f).removeAttr("style")):((d=v-(p=Math.floor((t.position.left-1)/c)))>h.before&&(d=h.before),p=v-d,f=g+d,s.attr("data-gs-x",p).removeAttr("style"),s.attr("data-gs-width",f).removeAttr("style")),void this.updateGridFlag(e);if(o)return a?(t.originalPosition.left!==t.position.left?(p=Math.floor((t.position.left-1)/c),(d=g+v-(p=this.cols-p))>g&&(d=0),f=g-d,(p=v)<=0&&(p=0),console.log("diffRight_RTL_COL_New __left")):(p=Math.ceil((t.position.left+t.size.width-11)/c),(d=v-(p=this.cols-p))>h.before&&(d=h.before),p=v-d,f=g+d),s.attr("data-gs-x",p).removeAttr("style"),s.attr("data-gs-width",f).removeAttr("style")):((f=g-(d=(p=Math.round((t.position.left-1)/c))-v))<=0&&(f=1,d=0),p=v+d,s.attr("data-gs-x",p).removeAttr("style"),s.attr("data-gs-width",f).removeAttr("style")),void this.updateGridFlag(e);var m,_=h.x;n<t.originalSize.width?((m=Math.round((t.position.left+t.size.width-11)/c))<=_&&(m=_+1),w=h.w-(_+h.w-m)):(m=Math.ceil((t.position.left+t.size.width-11)/c),w=h.w+(m-(_+h.w)),h.x+w>h.x+h.w+h.after&&(w=h.w+h.after)),w<=0&&(w=1),s.attr("data-gs-width",w).removeAttr("style"),this.updateGridFlag(e)},getFlag:function(e){var t,i=e.data("gridRowFlag")||[];if(_.isEmpty(i)){for(t=0;t<this.cols;t++)i[t]=0;e.data("gridRowFlag",i)}return i},updateGridFlag:function(t){var i,a=this,o=[];for(i=0;i<a.cols;i++)o[i]=0;return e(".grid-stack-item",t).each(function(t){e(this).removeAttr("style");var s=a.getX(e(this)),r=a.getW(e(this));for(i=s;i<s+r;i++)o[i]=i===s?e(this):1}),t.data("gridRowFlag",o),a.updateItemsPositions(o),a.sortGrid(t),o},addNewWidget:function(t,i){var a=this,o=a.container.find(".sparklewp-device-panel.sparklewp-panel-"+a.activePanel),s=i;_.isObject(s)||(s=o.find(".sparklewp-cb-items").first());var r=t;r.draggable({revert:"invalid",appendTo:o,scroll:!1,zIndex:99999,handle:".grid-stack-item-content",start:function(t,i){e("body").addClass("builder-item-moving"),e(".sparklewp-cb-items",o).css("z-index",""),i.helper.parent().css("z-index",9999)},stop:function(t,i){e("body").removeClass("builder-item-moving"),e(".sparklewp-cb-items",o).css("z-index",""),a.save()},drag:function(e,t){}}).resizable({handles:"w, e",start:function(e,t){t.originalElement.css({right:"auto",left:t.position.left})},stop:function(e,t){a.setGridWidth(t.element.parent(),t),a.save()}}),s.append(r),a.updateGridFlag(s)},addPanel:function(t){var i=this.getTemplate();if(0!=e("#tmpl-sparklewp-cb-panel").length)return _.isObject(o.rows)||(o.rows={}),'<div class="sparklewp-device-panel sparklewp-vertical-panel sparklewp-panel-'+t+'" data-device="'+t+'">'+i({device:t,id:o.id,rows:o.rows},"tmpl-sparklewp-cb-panel")+"</div>"},addDevicePanels:function(){var t=this;_.each(t.devices,function(i,a){var o=t.addPanel(a);e(".sparklewp-cb-devices-switcher",t.container).append('<a href="#" class="switch-to switch-to-'+a+'" data-device="'+a+'">'+i+"</a>"),e(".sparklewp-cb-body",t.container).append(o)})},addItem:function(t){var i=this.getTemplate();if(0!=e("#tmpl-sparklewp-cb-item").length){var a=i(t,"tmpl-sparklewp-cb-item");return e(a)}},addAvailableItems:function(){var t=this;_.each(t.devices,function(i,a){var o=e('<div class="sparklewp-available-items" data-device="'+a+'"></div>');e(".sparklewp-panel-"+a,t.container).append(o),o.append('<div class="spwp-close-item-wrap"><span class="spwp-close-item-panel dashicons dashicons-no"></span></div>'),_.each(t.items,function(e){var i=!0;if(!_.isUndefined(e.devices)&&!_.isEmpty(e.devices))if(_.isString(e.devices))e.devices!=a&&(i=!1);else{var s=!1;_.each(e.devices,function(e){a==e&&(s=!0)}),s||(i=!1)}if(i){var r=t.addItem(e);o.append(r)}})})},switchToDevice:function(t,i){_.size(this.devices)>1?(e(".sparklewp-cb-devices-switcher a",this.container).removeClass("sparklewp-tab-active"),e(".sparklewp-cb-devices-switcher .switch-to-"+t,this.container).addClass("sparklewp-tab-active"),e(".sparklewp-device-panel",this.container).addClass("sparklewp-panel-hide"),e(".sparklewp-device-panel.sparklewp-panel-"+t,this.container).removeClass("sparklewp-panel-hide"),this.activePanel=t):e(".sparklewp-cb-devices-switcher a",this.container).addClass("sparklewp-tab-active"),(_.isUndefined(i)||i)&&("desktop"==t?e("#customize-footer-actions .preview-desktop").trigger("click"):"mobile"==t&&e("#customize-footer-actions .preview-mobile").trigger("click"))},addExistingRowsItems:function(){var i=this,a=t.control(i.controlId).setting._value;_.isObject(a)||(a=a?JSON.parse(a):{}),_.each(i.panels,function(t,o){var s={};_.isObject(a[o])&&(s=a[o]),_.each(s,function(a,s){_.isUndefined(a)||_.each(a,function(a,r){var n=e('.sparklewp-available-items[data-device="'+o+'"] .grid-stack-item[data-id="'+a.id+'"]').first();n.attr("data-gs-width",a.width),n.attr("data-gs-x",a.x),n.removeClass("item-from-list"),i.addNewWidget(n,t[s])})})}),i.ready=!0},focus:function(){this.container.on("click",".sparklewp-cb-item-setting, .sparklewp-cb-item-name, .item-tooltip",function(i){i.preventDefault();var a=e(this).data("section")||"",o=e(this).attr("data-control")||"",s=!1;o&&(_.isUndefined(t.control(o))||(t.control(o).focus(),s=!0)),s||a&&!_.isUndefined(t.section(a))&&(t.section(a).focus(),s=!0)}),this.container.on("click",".sparklewp-cb-row-settings",function(i){i.preventDefault();var a=e(this).attr("data-id")||"",s=o.id+"_"+a;_.isUndefined(t.section(s))||t.section(s).focus()})},remove:function(){var t=this;i.on("click",".sparklewp-device-panel .sparklewp-cb-item-remove",function(i){i.preventDefault();var a=e(this).closest(".grid-stack-item"),o=a.closest(".sparklewp-device-panel");a.attr("data-gs-width",1),a.attr("data-gs-x",0),a.removeAttr("style"),e(".sparklewp-available-items",o).append(a),t.updateAllGrids(),t.save()})},encodeValue:function(e){return encodeURI(JSON.stringify(e))},decodeValue:function(e){return JSON.parse(decodeURI(e))},save:function(){var i=this;if(i.ready){var a={};_.each(i.panels,function(t,o){a[o]={},_.each(t,function(t,s){var r=_.map(e(" > .grid-stack-item",t),function(t){return t=e(t),{x:i.getX(t),y:1,width:i.getW(t),height:1,id:t.data("id")||""}});a[o][s]=r})}),t.control(i.controlId).setting.set(i.encodeValue(a))}},hidePanel:function(){this.container.removeClass("sparkle-builder-show"),s(this.container.find(".sparklewp-available-items")),e("#customize-preview").removeClass("cb--preview-panel-show").removeAttr("style")},showPanel:function(){var t=this;this.container.removeClass("sparkle-builder--hide").addClass("sparkle-builder-show"),setTimeout(function(){var i=t.container.height();e("#customize-preview").addClass("cb--preview-panel-show").css({bottom:i-1,"margin-top":"0px"})},100)},togglePanel:function(){var a=this;t.state("expandedPanel").bind(function(e){t.panel(o.panel).expanded()?(i.trigger("sparklewp_panel_builder_open",[o.panel]),top._current_builder_panel=r,a.showPanel()):a.hidePanel()}),a.container.on("click",".sparklewp-panel-close",function(t){t.preventDefault(),a.container.toggleClass("sparkle-builder--hide"),a.container.hasClass("sparkle-builder--hide")?e("#customize-preview").removeClass("cb--preview-panel-show"):e("#customize-preview").addClass("cb--preview-panel-show")})},panelLayoutCSS:function(){var i=e("#customize-controls").width();t.state("paneVisible").get()||(i=0),a?this.container.find(".sparklewp-cb-inner").css({"margin-right":i}):this.container.find(".sparklewp-cb-inner").css({"margin-left":i})},init:function(a,n,l){var c=this,d=c.getTemplate()(o,"tmpl-sparkle-builder-panel");c.container=e(d),e("body .wp-full-overlay").append(c.container),c.controlId=a,c.items=n,c.devices=l,o.section&&t.section(o.section).container.addClass("sparkle-hide"),c.addDevicePanels(),c.switchToDevice(c.activePanel),c.addAvailableItems(),c.switchToDevice(c.activePanel),c.drag_drop(),c.focus(),c.remove(),c.addExistingRowsItems(),t.panel(o.panel).expanded()?(console.log("open-builder:",o.panel),c.showPanel()):c.hidePanel(),t.previewedDevice.bind(function(e){"desktop"===e?c.switchToDevice("desktop",!1):c.switchToDevice("mobile",!1)}),c.togglePanel(),t.state("paneVisible").get()&&c.panelLayoutCSS(),t.state("paneVisible").bind(function(){c.panelLayoutCSS()}),e(window).resize(_.throttle(function(){c.panelLayoutCSS()},100)),c.container.on("click",".sparklewp-cb-devices-switcher a.switch-to",function(t){t.preventDefault();var i=e(this).data("device");c.switchToDevice(i),e(".sparklewp-cb-body").find(".sparklewp-available-items").each(function(){s(e(this))})}),i.trigger("sparklewp_builder_panel_loaded",[r,c])}};return n.init(o.control_id,o.items,o.devices),n};t.bind("ready",function(i,a){_.each(SparkleWP_Customizer_Builder.builders,function(e,t){new o(e,t)}),t.bind("pane-contents-reflowed",function(){setTimeout(function(){e("#sub-accordion-panel-widgets .no-widget-areas-rendered-notice .footer_moved_widgets_text").length||e("#sub-accordion-panel-widgets .no-widget-areas-rendered-notice").append('<p class="footer_moved_widgets_text">'+SparkleWP_Customizer_Builder.footer_moved_widgets_text+"</p>")},1e3)}),t.state("expandedSection").bind(function(t){e(".sparklewp-device-panel .grid-stack-item").removeClass("item-active"),e(".sparklewp-cb-row").removeClass("row-active"),t&&(e('.sparklewp-cb-row[data-id="'+t.id+'"]').addClass("row-active"),e(".sparklewp-device-panel .grid-stack-item.for-s-"+t.id).addClass("item-active"))})}),i.on("click",".focus-section",function(i){i.preventDefault();var a=e(this).attr("data-id")||"";a||(a=(a=e(this).attr("href")||"").replace("#","")),a&&t.section(a)&&t.section(a).focus()}),i.on("click",".focus-control",function(i){i.preventDefault();var a=e(this).attr("data-id")||"";a||(a=(a=e(this).attr("href")||"").replace("#","")),a&&t.control(a)&&t.control(a).focus()}),i.on("click",".focus-panel",function(i){i.preventDefault();var a=e(this).attr("data-id")||"";a||(a=(a=e(this).attr("href")||"").replace("#","")),a&&t.panel(a)&&t.panel(a).focus()});function s(t){var i=t.prev(".spwp-add-new-item");i.length||(i=i.prev(".sparklewp-cp-sidebar").find(".spwp-add-new-item")),t.length&&(t.removeClass("spwp-show-items"),e("body").removeClass("spwp-body-overlay"),i.removeClass("spwp-hide-items"))}i.on("mouseover",".sparklewp-cb-row .grid-stack-item",function(t){var i=e(this);e(".sparklewp-cb-item-remove",i).outerWidth()+e(".sparklewp-cb-item-setting",i).outerWidth()>e(".grid-stack-item-content",i).innerWidth()-50&&i.addClass("show-tooltip")}),i.on("mouseleave",".sparklewp-cb-row .grid-stack-item",function(t){e(this).removeClass("show-tooltip")}),i.on("click",".spwp-add-new-item",function(t){var i=e(this),a=i.next(".sparklewp-available-items");a.length||(a=i.closest(".sparklewp-cp-sidebar").next(".sparklewp-available-items")),a.length&&(a.toggleClass("spwp-show-items"),e("body").toggleClass("spwp-body-overlay"),i.toggleClass("spwp-hide-items"))}),i.on("click",".spwp-close-item-panel",function(t){s(e(this).closest(".sparklewp-available-items"))})}(jQuery,wp.customize||null);